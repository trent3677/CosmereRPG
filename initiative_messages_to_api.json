[
  {
    "role": "system",
    "content": "@ROLE={you_are:\"INITIATIVE COORDINATOR tracking combat flow\",job:\"Track who acted and provide CLEAR INSTRUCTIONS for turn_window\"}\n\n@INPUT={\n  current_round:\"integer from combat_round field (use exactly as given)\",\n  player_name:\"CRITICAL: exact PC name from 'player_name:' field in ROUND INFO (e.g., 'Aldric', 'Bob', etc.)\",\n  initiative_order:\"list of ALL creatures with (Initiative) - may include (player) tags which you MUST remove\",\n  recent_conversation:\"narration showing who acted THIS ROUND\"\n}\n\n@OUTPUT_CONTRACT={\n  sections_in_order: [\n    \"--- ROUND INFO ---\",\n    \"combat_round: <int>\",\n    \"player_name: <exact PC name>\",\n    \"--- LIVE TRACKER ---\",\n    \"**Live Initiative Tracker:**\",\n    \"<acted/dead/waiting lines>\",\n    \"<EXACTLY ONE instruction block>\",\n    \"<OPTIONAL: --- NAME HINTS --->\"\n  ],\n  authoritative: \"The instruction block defines the turn_window the Combat Sim MUST consume\",\n  ascii_only: \"No curly quotes or em/en dashes\",\n  exactly_one_instruction_block: true\n}\n\n@INSTRUCTION_BLOCKS={\n  CASE_A_npcs_before_player: {\n    header: \">>> PROCESS ALL OF THESE IN ONE RESPONSE (Initiative Order):\",\n    list: [\"<Non-player or allied NPC 1>\", \"<...>\", \"<Non-player or allied NPC N>\"],\n    stop: \">>> THEN STOP AT: <player_name> (Player)\"\n  },\n\n  CASE_B_player_turn_now: {\n    header: \">>> CURRENT: <player_name> (<initiative>) - PLAYER TURN (await input)\"\n  },\n\n  CASE_C_finish_to_end_round: {\n    header: \">>> PROCESS TO END ROUND:\",\n    list: [\"<Remaining non-player/allied NPCs after player>\"],\n    footer: \">>> THEN: End Round <X>, Start Round <X+1>\"\n  },\n\n  CASE_D_round_complete: {\n    header: \">>> ROUND COMPLETE\",\n    footer: \"All creatures have acted. Increment combat_round.\"\n  }\n}\n\n@NAME_HINTS_SECTION={\n  header: \"--- NAME HINTS ---\",\n  example: [\n    \"Skeleton_5: the fifth skeleton\",\n    \"Skeleton_4: the shield-bearing skeleton\"\n  ]\n}\n\n@DECISION_LOGIC={\n  identify_player: \"Use EXACT name from 'player_name:' field in ROUND INFO (NOT from (player) tags)\",\n  non_player_definition: \"ALL creatures EXCEPT the one matching player_name field (monsters + allied NPCs)\",\n  compute_state: \"from tracker lines [X]/[>]/[ ]/[D]\",\n  choose_case: [\n    \"FIRST CHECK: If ALL living are [X] or [D] -> CASE_D_round_complete (takes precedence)\",\n    \"Else if next to act is player_name -> CASE_B_player_turn_now\",\n    \"Else if player_name not yet acted and non_players precede -> CASE_A_npcs_before_player\",\n    \"Else if player_name has acted and non_players remain -> CASE_C_finish_to_end_round\"\n  ],\n  preserve_tie_order: \"Maintain input order for same-initiative ties\",\n  critical_rule: \"NPCs with titles (Scout, Ranger, Guard, Captain, etc.) go in PROCESS ALL blocks, NOT player turns\"\n}\n\n@EXAMPLES={\n  example1_npcs_before_player: \"Initiative: Goblin(20), Orc(15), Wolf(12), Bob(10), Kobold(5)\\nBob is player. Goblin acted.\\n\\n**Live Initiative Tracker:**\\n- [X] Goblin (20) - Acted\\n\\n>>> PROCESS ALL OF THESE IN ONE RESPONSE (Initiative Order):\\n- Orc (15)\\n- Wolf (12)\\n>>> THEN STOP AT: Bob (Player)\\n\\n- [ ] Kobold (5) - After Player\\n\\n--- NAME HINTS ---\\nOrc: the brutish orc\\nWolf: the snarling wolf\",\n  \n  example2_player_turn: \"All monsters acted, now Bob's turn:\\n\\n**Live Initiative Tracker:**\\n- [X] Goblin (20) - Acted\\n- [X] Orc (15) - Acted\\n- [X] Wolf (12) - Acted\\n\\n>>> CURRENT: Bob (10) - PLAYER TURN (await input)\\n\\n- [ ] Kobold (5) - Waiting\",\n  \n  example3_ending_round: \"Bob just acted, Kobold remains:\\n\\n**Live Initiative Tracker:**\\n- [X] Goblin (20) - Acted\\n- [X] Orc (15) - Acted\\n- [X] Wolf (12) - Acted\\n- [X] Bob (10) - Acted\\n\\n>>> PROCESS TO END ROUND:\\n- Kobold (5)\\n>>> THEN: End Round 1, Start Round 2\",\n  \n  example4_round_complete: \"Everyone has acted:\\n\\n**Live Initiative Tracker:**\\n- [X] Goblin (20) - Acted\\n- [X] Orc (15) - Acted\\n- [X] Wolf (12) - Acted\\n- [X] Bob (10) - Acted\\n- [X] Kobold (5) - Acted\\n\\n>>> ROUND COMPLETE\\nAll creatures have acted. Increment combat_round.\",\n  \n  example5_npcs_with_titles: \"player_name: Aldric\\nInitiative with titled NPCs:\\n\\n**Live Initiative Tracker:**\\n- [D] Zombie_1 (20) - Dead\\n- [ ] Guard Marcus (20) - Waiting\\n- [ ] Goblin_2 (18) - Waiting\\n- [ ] Captain Vale (12) - Waiting\\n- [ ] Aldric (5) - Waiting\\n- [ ] Scout Jenna (4) - Waiting\\n\\n>>> PROCESS ALL OF THESE IN ONE RESPONSE (Initiative Order):\\n- Guard Marcus (20)\\n- Goblin_2 (18)\\n- Captain Vale (12)\\n>>> THEN STOP AT: Aldric (Player)\\n\\n- [ ] Scout Jenna (4) - After Player\"\n}\n\n@CRITICAL_RULES={\n  turn_window_is_authoritative: \"The PROCESS/FINISH block defines turn_window consumed by Combat Sim\",\n  include_all_non_players: \"Include all monsters + allied NPCs before the player in CASE_A\",\n  name_hints_optional: \"OPTIONAL: emit --- NAME HINTS --- as alias map for narration\",\n  no_CURRENT_TURN_section: \"NEVER emit a '--- CURRENT TURN ---' block (enforced)\",\n  use_exact_names_only: \"Use exact names from INPUT without role tags in tracker lines\",\n  no_role_tags_in_lines: \"DO NOT annotate names with '(player)' in initiative lines; only in instruction block\",\n  include_player_tag_only_in_instruction_block: true,\n  maintain_order: \"Maintain strict initiative order within process groups\",\n  skip_dead: \"Dead creatures marked [D] are skipped in processing lists\"\n}\n\n@ROUND_ADVANCEMENT={\n  tracker_signals_completion: [\n    \"If all living are [X] or [D] -> emit CASE_D '>>> ROUND COMPLETE'\",\n    \"If processing to end round -> emit CASE_C with 'End Round X, Start Round Y'\"\n  ],\n  never_premature: \"Never signal round complete until all living have acted\"\n}\n\n@LINE_FORMAT={\n  tracker_line_format: \"- [status] CreatureName (initiative) - State\",\n  correct_examples: [\n    \"- [X] Guard Marcus (20) - Acted\",\n    \"- [ ] Aldric (5) - Waiting\",\n    \"- [D] Zombie_1 (20) - Dead\"\n  ],\n  incorrect_examples: [\n    \"- [X] Aldric (player) (5) - Acted  // WRONG: has (player) tag\",\n    \"- [X] Guard Marcus (NPC) (20) - Acted  // WRONG: has role tag\"\n  ],\n  rule: \"STRIP ALL role tags like (player) from tracker lines - use clean names only\",\n  instruction_block_only: \"Player designation appears ONLY in instruction blocks: '>>> THEN STOP AT: [PlayerName] (Player)'\"\n}\n- The PROCESS ALL block defines the authoritative turn_window for the combat DM\n- Non-player = monsters + allied NPCs (they must be included in PROCESS ALL list before the player)"
  },
  {
    "role": "user",
    "content": "--- ROUND INFO ---\ncombat_round: 2\nplayer_name: Eirik Hearthwise\n\nINITIATIVE ORDER:\n- Sahuagin (9) - dead\n- Eirik Hearthwise (8) - alive\n- Ranger Thane (7) - alive\n- Scout Elen (4) - alive\n- Scout Kira (3) - alive\n\n--- RECENT COMBAT CONVERSATION ---\n\nPlayer: --- ROUND INFO ---\ncombat_round: 1\nplayer_name: Eirik Hearthwise\n\n--- LIVE TRACKER ---\n**Live Initiative Tracker:**\n- [X] Sahuagin (9) - Acted\n- [X] Eirik Hearthwise (8) - Acted\n- [ ] Ranger Thane (7) - Waiting\n- [ ] Scout Elen (4) - Waiting\n- [ ] Scout Kira (3) - Waiting\n\n>>> PROCESS TO END ROUND:\n- Ranger Thane (7)\n- Scout Elen (4)\n- Scout Kira (3)\n>>> THEN: End Round 1, Start Round 2\n\n--- NAME HINTS ---\nSahuagin: the barnacle-crusted fish-man\nRanger Thane: the grim-faced ranger\nScout Elen: the archer\nScout Kira: the crouching scout\n--- CREATURE STATES ---\nEirik Hearthwise: HP 27/45, alive, Spell Slots: L1:1/4 L2:2/3 L3:0/2\nSahuagin: HP 14/22, alive\nScout Kira: HP 45/45, alive\nScout Elen: HP 36/36, alive, Spell Slots: L1:3/4 L2:2/2\nRanger Thane: HP 48/55, alive, Spell Slots: L1:4/4 L2:2/2\n\n--- DICE POOLS ---\nRules:\n- Player characters always roll their own dice\n- NPCs/monsters use pre-rolled dice pools exactly\n- Do not reuse dice; consume in order\n- For NPC/Monster ATTACK: use CREATURE ATTACKS list\n- For NPC/Monster SAVES: use SAVING THROWS list  \n- For damage/spells/other: use GENERIC DICE pool\n\nDM Note: COMBAT ROUND 1 - DICE AVAILABLE:\nPreroll Set ID: 1-4956 (Generated at round start)\n\nCRITICAL DICE USAGE:\n- For NPC/Monster ATTACKS, you MUST use a die from the \"CREATURE ATTACKS\" list for that specific creature.\n- For NPC/Monster SAVING THROWS, you MUST use a die from the \"SAVING THROWS\" list.\n- The \"GENERIC DICE\" pool is ONLY for damage rolls, spell effects, or other non-attack/non-save rolls.\n- FAILURE TO USE THE CORRECT POOL IS A CRITICAL ERROR.\n\n=== GENERIC DICE (use for spells, abilities, improvisation) ===\nd4: [4,2,3,1,1,4,2,3] | d6: [3,5,6,2,3,3,2,4] | d8: [1,6,3,7,7,4] | d10: [4,10,3,7,5,1] | d12: [12,9,8,11] | d20: [18,8,1,6,18,5,14,9,15,11]\n\n=== CREATURE ATTACKS (exact number per creature) ===\n[PLAYER: Eirik Hearthwise] Must make own rolls\nSahuagin: Attack[10], Attack[6], Attack[18], Attack[6], Attack[3] (5 attacks available: Multiattack, Bite, Claw, Spear (Melee), Spear (Ranged))\nScout Kira: Attack[3] (1 attack available: Shortbow Shot)\nScout Elen: Attack[5], Attack[1] (2 attacks available: Longbow, Shortsword)\nRanger Thane: Attack[1], Attack[3] (2 attacks available: Longbow, Shortsword)\n\n=== SAVING THROWS ===\nSahuagin: STR:5, DEX:18, CON:12, INT:15, WIS:15, CHA:10\nScout Kira: STR:4, DEX:10, CON:15, INT:6, WIS:3, CHA:8\nScout Elen: STR:8, DEX:12, CON:20, INT:15, WIS:18, CHA:2\nRanger Thane: STR:1, DEX:17, CON:4, INT:1, WIS:5, CHA:9\n\nIMPORTANT: Each creature can only make the number of attacks listed above.\nUse generic dice pool for damage rolls, spells, and other abilities.\nApply all appropriate modifiers (ability scores, proficiency, weapon bonuses, etc.).\nNote: Eirik Hearthwise must make their own rolls.\n\nCOMBAT TRACKING: You MUST include \"combat_round\" field in your JSON response.\nTrack combat rounds: increment ONLY when ALL alive creatures have completed their turns in initiative order.\nThese dice remain constant throughout the current round.\n\n--- RULES ---\n- Initiative must be followed strictly\n- Only increment combat_round after all alive creatures have acted\n- Status updates must be reflected in JSON \"actions\"\n- Do not narrate beyond current round\n\n--- PLAYER ACTION ---\nThats how you do it!\n\n--- REQUIRED RESPONSE ---\n1. Narrate and resolve actions for all NPCs/monsters in initiative order until:\n   - The LAST creature in this round has acted, OR\n   - Initiative returns to the player\n2. Stop narration at that point\n3. Return structured JSON with plan, narration, combat_round, and actions\n\nDM: {\n  \"plan\": \"Process end-of-round window: Ranger Thane, Scout Elen, and Scout Kira each fire a single arrow at the Sahuagin, using their respective attack prerolls. All three arrows strike, dealing 1, 6, and 3 piercing damage. Consolidate all enemy HP changes into a single updateEncounter action per system rules. Arrow expenditure for NPCs is handled narratively, not in actions[]. End of round reached; increment combat_round after this.\",\n  \"narration\": \"The grim-faced ranger releases his arrow, the shaft whistling through the briny air and striking the Sahuagin's shoulder. The archer’s aim is truer still—her arrow buries deep, drawing a spurt of blackish blood. From behind a battered crate, the crouching scout grins and looses her own shot, the arrow glancing off barnacled scales and finding flesh. The battered fish-man staggers, bristling with shafts. Splinters and salt spray fill the air. The dock trembles beneath the onslaught. Three arrows gone.\",\n  \"combat_round\": 2,\n  \"actions\": [\n    {\n      \"action\": \"updateEncounter\",\n      \"parameters\": {\n        \"encounterId\": \"L03-E3\",\n        \"changes\": \"Sahuagin is struck by three arrows: Ranger Thane hits for 1 piercing (HP 14->13), Scout Elen hits for 6 piercing (HP 13->7), Scout Kira hits for 3 piercing (HP 7->4).\"\n      }\n    }\n  ]\n}\n\nPlayer: --- ROUND INFO ---\ncombat_round: 2\nplayer_name: Eirik Hearthwise\n\n--- LIVE TRACKER ---\n**Live Initiative Tracker:**\n- [ ] Sahuagin (9) - Waiting\n- [ ] Eirik Hearthwise (8) - Waiting\n- [ ] Ranger Thane (7) - Waiting\n- [ ] Scout Elen (4) - Waiting\n- [ ] Scout Kira (3) - Waiting\n\n>>> PROCESS ALL OF THESE IN ONE RESPONSE (Initiative Order):\n- Sahuagin (9)\n>>> THEN STOP AT: Eirik Hearthwise (Player)\n\n- [ ] Ranger Thane (7) - After Player\n- [ ] Scout Elen (4) - After Player\n- [ ] Scout Kira (3) - After Player\n\n--- NAME HINTS ---\nSahuagin: the barnacle-crusted fish-man\nRanger Thane: the grim-faced ranger\nScout Elen: the archer\nScout Kira: the crouching scout\n--- CREATURE STATES ---\nEirik Hearthwise: HP 27/45, alive, Spell Slots: L1:1/4 L2:2/3 L3:0/2\nSahuagin: HP 4/22, alive\nScout Kira: HP 45/45, alive\nScout Elen: HP 36/36, alive, Spell Slots: L1:3/4 L2:2/2\nRanger Thane: HP 48/55, alive, Spell Slots: L1:4/4 L2:2/2\n\n--- DICE POOLS ---\nRules:\n- Player characters always roll their own dice\n- NPCs/monsters use pre-rolled dice pools exactly\n- Do not reuse dice; consume in order\n- For NPC/Monster ATTACK: use CREATURE ATTACKS list\n- For NPC/Monster SAVES: use SAVING THROWS list  \n- For damage/spells/other: use GENERIC DICE pool\n\nDM Note: COMBAT ROUND 2 - DICE AVAILABLE:\nPreroll Set ID: 2-3367 (Generated at round start)\n\nCRITICAL DICE USAGE:\n- For NPC/Monster ATTACKS, you MUST use a die from the \"CREATURE ATTACKS\" list for that specific creature.\n- For NPC/Monster SAVING THROWS, you MUST use a die from the \"SAVING THROWS\" list.\n- The \"GENERIC DICE\" pool is ONLY for damage rolls, spell effects, or other non-attack/non-save rolls.\n- FAILURE TO USE THE CORRECT POOL IS A CRITICAL ERROR.\n\n=== GENERIC DICE (use for spells, abilities, improvisation) ===\nd4: [3,3,1,2,2,2,2,4] | d6: [5,1,5,1,1,6,2,4] | d8: [5,3,6,8,7,3] | d10: [10,7,6,9,2,9] | d12: [1,3,3,11] | d20: [15,8,20,6,18,10,3,5,3,5]\n\n=== CREATURE ATTACKS (exact number per creature) ===\n[PLAYER: Eirik Hearthwise] Must make own rolls\nSahuagin: Attack[9], Attack[16], Attack[18], Attack[20], Attack[17] (5 attacks available: Multiattack, Bite, Claw, Spear (Melee), Spear (Ranged))\nScout Kira: Attack[5] (1 attack available: Shortbow Shot)\nScout Elen: Attack[9], Attack[1] (2 attacks available: Longbow, Shortsword)\nRanger Thane: Attack[16], Attack[8] (2 attacks available: Longbow, Shortsword)\n\n=== SAVING THROWS ===\nSahuagin: STR:10, DEX:2, CON:4, INT:9, WIS:9, CHA:11\nScout Kira: STR:3, DEX:11, CON:10, INT:2, WIS:17, CHA:18\nScout Elen: STR:6, DEX:20, CON:16, INT:13, WIS:12, CHA:11\nRanger Thane: STR:12, DEX:7, CON:20, INT:13, WIS:1, CHA:11\n\nIMPORTANT: Each creature can only make the number of attacks listed above.\nUse generic dice pool for damage rolls, spells, and other abilities.\nApply all appropriate modifiers (ability scores, proficiency, weapon bonuses, etc.).\nNote: Eirik Hearthwise must make their own rolls.\n\nCOMBAT TRACKING: You MUST include \"combat_round\" field in your JSON response.\nTrack combat rounds: increment ONLY when ALL alive creatures have completed their turns in initiative order.\nThese dice remain constant throughout the current round.\n\n--- RULES ---\n- Initiative must be followed strictly\n- Only increment combat_round after all alive creatures have acted\n- Status updates must be reflected in JSON \"actions\"\n- Do not narrate beyond current round\n\n--- PLAYER ACTION ---\nit's wounded, let's finish it\n\n--- REQUIRED RESPONSE ---\n1. Narrate and resolve actions for all NPCs/monsters in initiative order until:\n   - The LAST creature in this round has acted, OR\n   - Initiative returns to the player\n2. Stop narration at that point\n3. Return structured JSON with plan, narration, combat_round, and actions\n\nDM: {\n  \"plan\": \"Round 2. Sahuagin acts first, using Multiattack: Bite (Attack[9]), Claw (Attack[16]), Claw (Attack[18]) against Eirik Hearthwise. Only the third attack (18) hits Eirik's AC 17. Claw deals 6 slashing damage (d6[5]+1). Damage to player must be logged in updateEncounter, not updateCharacterInfo. Stop after Sahuagin; next is Eirik Hearthwise (player).\",\n  \"narration\": \"Desperation wild in its eyes, the barnacle-crusted fish-man lunges again. Its jaws snap shut with a hollow clack, and its first claw screeches harmlessly off your shield. But its second swipe finds flesh—pain arcs up your arm as blood spatters the warped dock. The boards groan beneath your boots, salt wind stinging your face. The Sahuagin's breath rasps, thick with fury.\",\n  \"combat_round\": 2,\n  \"actions\": [\n    {\n      \"action\": \"updateEncounter\",\n      \"parameters\": {\n        \"encounterId\": \"L03-E3\",\n        \"changes\": \"Eirik Hearthwise takes 6 slashing damage from Sahuagin's claw (HP 27->21).\"\n      }\n    }\n  ]\n}\n\nPlayer: --- ROUND INFO ---\ncombat_round: 2\nplayer_name: Eirik Hearthwise\n\n--- LIVE TRACKER ---\n**Live Initiative Tracker:**\n- [X] Sahuagin (9) - Acted\n- [ ] Eirik Hearthwise (8) - Waiting\n- [ ] Ranger Thane (7) - Waiting\n- [ ] Scout Elen (4) - Waiting\n- [ ] Scout Kira (3) - Waiting\n\n>>> CURRENT: Eirik Hearthwise (8) - PLAYER TURN (await input)\n\n- [ ] Ranger Thane (7) - Waiting\n- [ ] Scout Elen (4) - Waiting\n- [ ] Scout Kira (3) - Waiting\n\n--- NAME HINTS ---\nSahuagin: the barnacle-crusted fish-man\nRanger Thane: the grim-faced ranger\nScout Elen: the archer\nScout Kira: the crouching scout\n--- CREATURE STATES ---\nEirik Hearthwise: HP 27/45, alive, Spell Slots: L1:1/4 L2:2/3 L3:0/2\nSahuagin: HP 4/22, alive\nScout Kira: HP 45/45, alive\nScout Elen: HP 36/36, alive, Spell Slots: L1:3/4 L2:2/2\nRanger Thane: HP 48/55, alive, Spell Slots: L1:4/4 L2:2/2\n\n--- DICE POOLS ---\nRules:\n- Player characters always roll their own dice\n- NPCs/monsters use pre-rolled dice pools exactly\n- Do not reuse dice; consume in order\n- For NPC/Monster ATTACK: use CREATURE ATTACKS list\n- For NPC/Monster SAVES: use SAVING THROWS list  \n- For damage/spells/other: use GENERIC DICE pool\n\nDM Note: COMBAT ROUND 2 - DICE AVAILABLE:\nPreroll Set ID: 2-3367 (Generated at round start)\n\nCRITICAL DICE USAGE:\n- For NPC/Monster ATTACKS, you MUST use a die from the \"CREATURE ATTACKS\" list for that specific creature.\n- For NPC/Monster SAVING THROWS, you MUST use a die from the \"SAVING THROWS\" list.\n- The \"GENERIC DICE\" pool is ONLY for damage rolls, spell effects, or other non-attack/non-save rolls.\n- FAILURE TO USE THE CORRECT POOL IS A CRITICAL ERROR.\n\n=== GENERIC DICE (use for spells, abilities, improvisation) ===\nd4: [3,3,1,2,2,2,2,4] | d6: [5,1,5,1,1,6,2,4] | d8: [5,3,6,8,7,3] | d10: [10,7,6,9,2,9] | d12: [1,3,3,11] | d20: [15,8,20,6,18,10,3,5,3,5]\n\n=== CREATURE ATTACKS (exact number per creature) ===\n[PLAYER: Eirik Hearthwise] Must make own rolls\nSahuagin: Attack[9], Attack[16], Attack[18], Attack[20], Attack[17] (5 attacks available: Multiattack, Bite, Claw, Spear (Melee), Spear (Ranged))\nScout Kira: Attack[5] (1 attack available: Shortbow Shot)\nScout Elen: Attack[9], Attack[1] (2 attacks available: Longbow, Shortsword)\nRanger Thane: Attack[16], Attack[8] (2 attacks available: Longbow, Shortsword)\n\n=== SAVING THROWS ===\nSahuagin: STR:10, DEX:2, CON:4, INT:9, WIS:9, CHA:11\nScout Kira: STR:3, DEX:11, CON:10, INT:2, WIS:17, CHA:18\nScout Elen: STR:6, DEX:20, CON:16, INT:13, WIS:12, CHA:11\nRanger Thane: STR:12, DEX:7, CON:20, INT:13, WIS:1, CHA:11\n\nIMPORTANT: Each creature can only make the number of attacks listed above.\nUse generic dice pool for damage rolls, spells, and other abilities.\nApply all appropriate modifiers (ability scores, proficiency, weapon bonuses, etc.).\nNote: Eirik Hearthwise must make their own rolls.\n\nCOMBAT TRACKING: You MUST include \"combat_round\" field in your JSON response.\nTrack combat rounds: increment ONLY when ALL alive creatures have completed their turns in initiative order.\nThese dice remain constant throughout the current round.\n\n--- RULES ---\n- Initiative must be followed strictly\n- Only increment combat_round after all alive creatures have acted\n- Status updates must be reflected in JSON \"actions\"\n- Do not narrate beyond current round\n\n--- PLAYER ACTION ---\nI attach with my mace and roll a 17! My dame is 8 +2 for 10 total\n\n--- REQUIRED RESPONSE ---\n1. Narrate and resolve actions for all NPCs/monsters in initiative order until:\n   - The LAST creature in this round has acted, OR\n   - Initiative returns to the player\n2. Stop narration at that point\n3. Return structured JSON with plan, narration, combat_round, and actions\n\nDM: {\n  \"plan\": \"Eirik Hearthwise acts. He attacks the Sahuagin with his mace, rolling a 17 (hits AC 12). He deals 10 bludgeoning damage, enough to reduce the Sahuagin from 4 HP to 0 HP, killing it. No further NPC/monster actions to process until after player. Sahuagin is now dead.\",\n  \"narration\": \"You heft your mace and drive it down with righteous fury. The blow lands square atop the barnacle-crusted skull—the crack echoes over the restless surf as bone shatters and salt spray bursts upward. The fish-man's eyes go wide, then empty. It collapses onto the warped planks, sending a final tremor through the dock. Victory, for now.\",\n  \"combat_round\": 2,\n  \"actions\": [\n    {\n      \"action\": \"updateEncounter\",\n      \"parameters\": {\n        \"encounterId\": \"L03-E3\",\n        \"changes\": \"Sahuagin takes 10 bludgeoning damage (HP 4->-6) and is now dead.\"\n      }\n    }\n  ]\n}\n"
  },
  {
    "role": "assistant",
    "content": "--- ROUND INFO ---\ncombat_round: 2\nplayer_name: Eirik Hearthwise\n\n--- LIVE TRACKER ---\n**Live Initiative Tracker:**\n- [X] Sahuagin (9) - Acted\n- [X] Eirik Hearthwise (8) - Acted\n- [ ] Ranger Thane (7) - Waiting\n- [ ] Scout Elen (4) - Waiting\n- [ ] Scout Kira (3) - Waiting\n\n>>> PROCESS TO END ROUND:\n- Ranger Thane (7)\n- Scout Elen (4)\n- Scout Kira (3)\n>>> THEN: End Round 2, Start Round 3\n\n--- NAME HINTS ---\nSahuagin: the barnacle-crusted fish-man\nRanger Thane: the grim-faced ranger\nScout Elen: the archer\nScout Kira: the crouching scout"
  }
]